#!/usr/bin/env bash

cd $HOME

mkdir -p codespace
[ -d codespace/menghanrc ] || git clone https://github.com/menghan/menghanrc.git codespace/menghanrc
(cd codespace/menghanrc && git pull)

# bash
ln -sf ~/codespace/menghanrc/dot-bashrc/bashrc.basic .bashrc.basic
ln -sf ~/codespace/menghanrc/dot-bashrc/bashrc.aliases .bashrc.aliases
touch .bashrc.local

touch ~/.bashrc
grep -q '.bashrc.basic' ~/.bashrc || echo "source ~/.bashrc.basic" >> ~/.bashrc
grep -q '.bashrc.aliases' ~/.bashrc || echo "source ~/.bashrc.aliases" >> ~/.bashrc
grep -q '.bashrc.local' ~/.bashrc || echo "[ -f ~/.bashrc.local ] && source ~/.bashrc.local" >> ~/.bashrc
touch ~/.bash_profile
grep -q '.bashrc' ~/.bash_profile || echo "[ -f ~/.bashrc ] && source ~/.bashrc" >> ~/.bash_profile

ln -sf ~/codespace/menghanrc/dot-gitconfig .gitconfig
ln -sf ~/codespace/menghanrc/dot-toprc .toprc
ln -sf ~/codespace/menghanrc/dot-tmux.conf .tmux.conf
ln -sf ~/codespace/menghanrc/dot-tigrc .tigrc
mkdir -p ~/.pip && ln -sf ~/codespace/menghanrc/dot-pip-conf .pip/pip.conf

mkdir -p bin
for f in `ls ~/codespace/menghanrc/bin/git-*`
do
	ln -sf $f bin
done

# vim
if which vim >/dev/null 2>&1; then
	[ -d codespace/vimfiles ] || git clone https://github.com/menghan/menghan-vimfiles.git codespace/vimfiles
	(cd codespace/vimfiles && git pull)
	[ -d ~/.vim ] || ln -sf codespace/vimfiles .vim
	mkdir -p ~/.vim/bundle
	[ -d ~/.vim/bundle/vundle ] || git clone https://github.com/gmarik/vundle.git ~/.vim/bundle/vundle
	ln -sf ~/.vim/Additions/_vimrc.linux .vimrc
	ln -sf ~/.vim/Additions/_gvimrc.linux .gvimrc
	vim -c 'BundleInstall' -c qa
fi
